{% extends "base.html" %}

{% load static %}

{% block title %}
  User Profile: {{ user_profile.display_name }}
{% endblock title %}

{% block content %}
  {% csrf_token %}
  <!-- Left Sidebar -->
  {% include 'pages/left_nav.html' %}
  
  <!-- Main Content -->
  <div class="main-content">
    <!-- Profile Header -->
    <div class="profile-header">
      {% if user_profile.banner_picture %}
        <img src="{{ user_profile.banner_picture.url }}" alt="Banner" class="banner-image">
      {% else %}
        <div class="banner-placeholder"></div>
      {% endif %}
      
      <!-- Edit Profile Button -->
      {% if user_profile.user == request.user %}
        <div class="edit-profile-button-container">
          <button type="button" class="post-button" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="ri-edit-line"></i>
            <span>Edit Profile</span>
          </button>
        </div>
      {% endif %}
      
      <div class="profile-info">
        <div class="profile-picture">
          {% if user_profile.profile_picture %}
            <img src="{{ user_profile.profile_picture.url }}" alt="Profile Picture">
          {% else %}
            <div class="avatar-placeholder">
              <i class="ri-user-line"></i>
            </div>
          {% endif %}
        </div>
        
        <div class="profile-details">
          <h1>{{ user_profile.display_name }}</h1>
          <div class="username-container">
            <p class="username">@{{ user_profile.username }}</p>
            {% if user_profile.is_moderator %}
              <div class="badge badge-primary">Moderator</div>
            {% endif %}
            {% if user_profile.is_collaborator %}
              <div class="badge badge-secondary">Collaborator</div>
            {% endif %}
            {% if user_profile.is_digital_twin %}
              <div class="badge badge-info">Digital Twin</div>
            {% endif %}
          </div>
          {% if user_profile.bio %}
            <p class="bio">{{ user_profile.bio }}</p>
          {% endif %}
          
          <div class="profile-stats">
            <span>{{ user_profile.num_followers }} Followers</span>
            <span>{{ user_profile.num_following }} Following</span>
          </div>
        </div>
      </div>
    </div>

    <!-- User Status -->
    {% if user_profile.is_banned %}
      <div class="alert alert-warning mt-4">
        <h4>Account Suspended</h4>
        <p>This account has been suspended for violating community guidelines.</p>
      </div>
    {% endif %}
  </div>

  <!-- Right Sidebar -->
  {% include 'pages/right_content.html' %}

  <!-- Profile Edit Modal -->
  {% if user_profile.user == request.user %}
    {% include 'users/user_profile_modal.html' %}
  {% endif %}
{% endblock content %}

{% block inline_javascript %}
<script>
  // Handle form submission
  document.getElementById('profileEditForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    fetch('{% url "users:update_profile" experiment.identifier %}', {
      method: 'POST',
      body: formData,
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Reload the page to show updated profile
        window.location.reload();
      } else {
        // Show error message
        alert('Error updating profile: ' + data.error);
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while updating your profile.');
    });
  });
</script>
{% endblock inline_javascript %} 