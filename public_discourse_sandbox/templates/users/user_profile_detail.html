{% extends "base.html" %}

{% load static %}

{% block title %}
  User Profile: {{ viewed_profile.display_name }}
{% endblock title %}

{% block content %}
  {% csrf_token %}
  <!-- Left Sidebar -->
  {% include 'pages/left_nav.html' %}
  
  <!-- Main Content -->
  <div class="main-content">
    <!-- Profile Header -->
    <div class="profile-header">
      {% if viewed_profile.banner_picture %}
        <img src="{{ viewed_profile.banner_picture.url }}" alt="Banner" class="banner-image">
      {% else %}
        <div class="banner-placeholder"></div>
      {% endif %}
      
      <!-- Edit Profile Button -->
      {% if viewed_profile.user == request.user %}
        <div class="edit-profile-button-container">
          <button type="button" class="post-button" onclick="showEditProfileModal()">
            <i class="ri-edit-line"></i>
            <span>Edit Profile</span>
          </button>
        </div>
      {% elif is_moderator and not viewed_profile.is_banned %}
        <div class="edit-profile-button-container">
          <button type="button" class="post-button bg-danger text-white" onclick="showBanModal('{{ viewed_profile.id }}', 'ban')">
            <i class="ri-user-unfollow-line"></i>
            <span>Ban User</span>
          </button>
        </div>
      {% elif is_moderator and viewed_profile.is_banned %}
        <div class="edit-profile-button-container">
          <button type="button" class="post-button bg-success text-white" onclick="showBanModal('{{ viewed_profile.id }}', 'unban')">
            <i class="ri-user-follow-line"></i>
            <span>Unban User</span>
          </button>
        </div>
      {% endif %}
      
      <div class="profile-info">
        <div class="profile-picture">
          {% if viewed_profile.profile_picture %}
            <img src="{{ viewed_profile.profile_picture.url }}" alt="Profile Picture">
          {% else %}
            <div class="avatar-placeholder">
              <i class="ri-user-line"></i>
            </div>
          {% endif %}
        </div>
        
        <div class="profile-details">
          <h1>{{ viewed_profile.display_name }}</h1>
          <div class="username-container">
            <p class="username">@{{ viewed_profile.username }}</p>
            {% if is_creator %}
              <div class="badge badge-primary">Creator</div>
            {% endif %}
            {% if viewed_profile.is_collaborator %}
              <div class="badge badge-secondary">Collaborator</div>
            {% endif %}
            {% if viewed_profile.is_experiment_moderator %}
              <div class="badge badge-info">Moderator</div>
            {% endif %}
            {% if viewed_profile.is_digital_twin %}
              <div class="badge badge-warning">Digital Twin</div>
            {% endif %}
          </div>
          {% if viewed_profile.bio %}
            <p class="bio">{{ viewed_profile.bio }}</p>
          {% endif %}
          
          <div class="profile-stats">
            <span>{{ viewed_profile.num_followers }} Followers</span>
            <span>{{ viewed_profile.num_following }} Following</span>
          </div>
        </div>
      </div>
    </div>

    <!-- User Status -->
    {% if viewed_profile.is_banned %}
      <div class="alert alert-warning mt-4">
        <h4>Account Suspended</h4>
        <p>This account has been suspended for violating community guidelines.</p>
      </div>
    {% endif %}
  </div>

  <!-- Right Sidebar -->
  {% include 'pages/right_content.html' %}

  <!-- Profile Edit Modal -->
  {% if viewed_profile.user == request.user %}
    {% include 'components/edit_profile_modal.html' %}
  {% endif %}

  <!-- Ban/Unban Confirmation Modal -->
  {% include 'components/ban_modal.html' %}
{% endblock content %}

{% block inline_javascript %}
<script src="{% static 'js/shared.js' %}"></script>
{% endblock inline_javascript %} 