{% extends "base.html" %}

{% load static %}

{% block title %}
  Moderator Dashboard - {{ experiment.name }}
{% endblock title %}

{% block content %}
  {% csrf_token %}
  <!-- Left Sidebar -->
  {% include 'pages/left_nav.html' %}
  
  <!-- Main Content -->
  <div class="main-content">
    <h1>Moderator Dashboard</h1>
    
    <!-- Using context processor's is_moderator -->
    {% if is_moderator %}
      <div class="alert alert-success">
        You have moderator permissions for this experiment.
      </div>
    {% endif %}
    
    <!-- Using mixin's is_moderator (same as above) -->
    {% if is_moderator %}
      <div class="dashboard-section">
        <h2>Banned Users</h2>
        {% if banned_users %}
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Display Name</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in banned_users %}
                  <tr>
                    <td>@{{ user.username }}</td>
                    <td>{{ user.display_name }}</td>
                    <td>
                      <button class="btn btn-sm btn-success" 
                              onclick="unbanUser('{{ user.id }}')">
                        Unban
                      </button>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>No banned users in this experiment.</p>
        {% endif %}
      </div>
      
      <div class="dashboard-section">
        <h2>Recent Posts</h2>
        {% if reported_posts %}
          <div class="posts-list">
            {% for post in reported_posts %}
              <div class="post-card" data-post-id="{{ post.id }}">
                <div class="post-header">
                  <span class="username">@{{ post.user_profile.username }}</span>
                  <span class="timestamp">{{ post.created_date|timesince }} ago</span>
                </div>
                <div class="post-content">
                  {{ post.content }}
                </div>
                <div class="post-actions">
                  <button class="btn btn-sm btn-danger" 
                          onclick="deletePost('{{ post.id }}')">
                    Delete
                  </button>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p>No recent posts to moderate.</p>
        {% endif %}
      </div>
    {% else %}
      <div class="alert alert-danger">
        You do not have permission to view this page.
      </div>
    {% endif %}
  </div>
  
  <!-- Right Sidebar -->
  {% include 'pages/right_content.html' %}

  <!-- Ban/Unban Confirmation Modal -->
  {% include 'components/ban_modal.html' %}

  <!-- Delete Confirmation Modal -->
  {% include 'components/delete_modal.html' %}
{% endblock content %}

{% block inline_javascript %}
<script src="{% static 'js/shared.js' %}"></script>
<script>
  function unbanUser(userId) {
    showBanModal(userId, 'unban');
  }
  
  function deletePost(postId) {
    showDeleteModal(postId);
  }
</script>
{% endblock inline_javascript %} 