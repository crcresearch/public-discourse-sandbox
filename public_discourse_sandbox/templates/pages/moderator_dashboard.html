{% extends "base.html" %}

{% load static %}

{% block title %}
  Moderator Dashboard - {{ experiment.name }}
{% endblock title %}

{% block content %}
  {% csrf_token %}
  <!-- Left Sidebar -->
  {% include 'pages/left_nav.html' %}
  
  <!-- Main Content -->
  <div class="main-content">
    <h1>Moderator Dashboard</h1>
    <!-- Using mixin's is_moderator -->
    {% if is_moderator %}
      <div class="dashboard-section">
        <h2>Banned Users</h2>
        {% if banned_users %}
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Display Name</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in banned_users %}
                  <tr>
                    <td>@{{ user.username }}</td>
                    <td>{{ user.display_name }}</td>
                    <td>
                      <button class="post-button" 
                              style="background-color: #28a745; padding: 4px 12px; min-height: 32px;"
                              onclick="unbanUser('{{ user.id }}')">
                        <i class="ri-user-unfollow-line"></i>
                        <span>Unban</span>
                      </button>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p>No banned users in this experiment.</p>
        {% endif %}
      </div>
      
      <div class="dashboard-section">
        <h2>Recent Posts</h2>
        {% if reported_posts %}
          <div class="posts-list">
            {% for post in reported_posts %}
              <div class="post-card card mb-3" data-post-id="{{ post.id }}">
                <div class="card-body">
                  <div class="post-header d-flex justify-content-between align-items-center mb-2">
                    <div class="user-info">
                      <a href="{% url 'users:detail' post.user_profile.user.id %}">
                        <span class="username fw-bold">@{{ post.user_profile.username }}</span>
                      </a>
                      <span class="timestamp text-muted ms-2">{{ post.created_date|timesince }} ago</span>
                    </div>
                    <div class="post-actions">
                      <button class="post-button" 
                              style="background-color: #dc3545; padding: 4px 12px; min-height: 32px;"
                              onclick="showDeleteModal('{{ post.id }}')">
                        <i class="ri-delete-bin-line"></i>
                        <span>Delete</span>
                      </button>
                    </div>
                  </div>
                  <div class="mod-post-content">
                    {{ post.content }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info">
            <i class="ri-information-line"></i> No recent posts to moderate.
          </div>
        {% endif %}
      </div>
    {% else %}
      <div class="alert alert-danger">
        <i class="ri-error-warning-line"></i> You do not have permission to view this page.
      </div>
    {% endif %}
  </div>
  
  <!-- Right Sidebar -->
  {% include 'pages/right_content.html' %}

  <!-- Ban/Unban Confirmation Modal -->
  {% include 'components/ban_modal.html' %}

  <!-- Delete Confirmation Modal -->
  {% include 'components/delete_modal.html' %}
{% endblock content %}

{% block inline_javascript %}
<script src="{% static 'js/shared.js' %}"></script>
<script>
  function unbanUser(userId) {
    showBanModal(userId, 'unban');
  }
</script>
{% endblock inline_javascript %} 